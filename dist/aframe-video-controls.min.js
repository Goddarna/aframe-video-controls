!function(e){function t(a){if(i[a])return i[a].exports;var s=i[a]={exports:{},id:a,loaded:!1};return e[a].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("video-controls",{schema:{src:{type:"string"},size:{type:"number","default":1},distance:{type:"number","default":2}},position_time_from_steps:function(){var e=this.current_step/this.bar_steps;this.video_el.readyState>0&&(this.video_el.currentTime=e*this.video_el.duration)},position_control_from_camera:function(){for(var e=this,t=document.querySelectorAll("a-camera"),i=0;i<t.length;i++){var a=t[i];if(a.getAttribute("camera").active){var s=a.object3D.getWorldDirection().projectOnPlane(new THREE.Vector3(0,1,0)).setLength(e.data.distance);e.el.object3D.position.copy(a.object3D.getWorldPosition().sub(s)),e.el.object3D.lookAt(a.object3D.getWorldPosition())}}},init:function(){var e=this;this.bar_steps=10,this.current_step=0,this.el.setAttribute("visible",!0),this.video_selector=this.data.src,this.video_el=document.querySelector(this.video_selector),this.video_el.pause(),this.video_el.addEventListener("ended",function(){e.play_image.setAttribute("src","#video-play-image")}),this.play_image=document.createElement("a-image"),this.play_image.setAttribute("src","#video-play-image"),this.bar_canvas=document.createElement("canvas"),this.bar_canvas.setAttribute("id","video_player_canvas"),this.bar_canvas.width=1024,this.bar_canvas.height=256,this.bar_canvas.style.display="none",this.context=this.bar_canvas.getContext("2d"),this.texture=new THREE.Texture(this.bar_canvas),this.play_image.addEventListener("click",function(t){e.video_el.paused?(this.setAttribute("src","#video-pause-image"),e.video_el.play()):(this.setAttribute("src","#video-play-image"),e.video_el.pause()),t.stopPropagation(),t.preventDefault()}),window.addEventListener("keyup",function(t){switch(t.keyCode){case 32:e.play_image.dispatchEvent(new Event("click"));break;case 37:e.current_step=0,e.position_time_from_steps();break;case 39:e.current_step=e.bar_steps,e.position_time_from_steps();break;case 38:e.current_step=e.current_step<e.bar_steps?e.current_step+1:e.current_step,e.position_time_from_steps();break;case 40:e.current_step=e.current_step>0?e.current_step-1:e.current_step,e.position_time_from_steps()}},!1),this.bar=document.createElement("a-plane"),this.bar.setAttribute("color","#000"),this.bar.addEventListener("click",function(t){var i=document.querySelector("a-cursor").components.raycaster.raycaster.intersectObject(this.object3D,!0)[0].point,a=this.object3D.worldToLocal(i).x,s=a/e.data.size+.5;e.current_step=Math.round(s*e.bar_steps),e.video_el.readyState>0&&(e.video_el.currentTime=s*e.video_el.duration),t.stopPropagation(),t.preventDefault()}),this.el.appendChild(this.bar_canvas),this.el.appendChild(this.play_image),this.el.appendChild(this.bar),this.el.sceneEl.addEventListener("loaded",function(){e.position_control_from_camera(),this.addEventListener("dblclick",function(){var t=document.querySelector("a-cursor").components.raycaster.raycaster;0==t.intersectObject(e.el.object3D,!0).length&&(e.el.getAttribute("visible")?e.el.setAttribute("visible",!1):(e.el.setAttribute("visible",!0),e.position_control_from_camera()))})})},update:function(e){this.position_control_from_camera(),this.bar.setAttribute("height",this.data.size/4),this.bar.setAttribute("width",this.data.size),this.bar.setAttribute("position","0.0 0.0 0"),this.play_image.setAttribute("height",this.data.size/4),this.play_image.setAttribute("width",this.data.size/4),this.play_image.setAttribute("position",-this.data.size/2*1.4+" 0 0")},remove:function(){},tick:function(e){if("undefined"==typeof this.last_time||e-this.last_time>250){if(this.video_el.readyState>0){var t=Math.floor(this.video_el.currentTime/60),i=Math.floor(this.video_el.currentTime%60);t=10>t?"0"+t:t,i=10>i?"0"+i:i;var a=Math.floor(this.video_el.duration/60),s=Math.floor(this.video_el.duration%60);a=10>a?"0"+a:a,s=10>s?"0"+s:s;var r=t+":"+i+" / "+a+":"+s,o=this.bar_canvas.width/this.video_el.duration;if(this.video_el.buffered.length>0){this.current_step=Math.round(this.video_el.currentTime/this.video_el.duration*this.bar_steps);var n=this.context;if(n.fillStyle="black",n.fillRect(0,0,this.bar_canvas.width,this.bar_canvas.height),n.font="70px Helvetica Neue",n.fillStyle="white",n.textAlign="center",n.fillText(r,this.bar_canvas.width/2,.65*this.bar_canvas.height),this.video_el.seeking)n.font="30px Helvetica Neue",n.fillStyle="yellow",n.textAlign="end",n.fillText("Seeking",.95*this.bar_canvas.width,.6*this.bar_canvas.height);else{var l=this.video_el.buffered.end(this.video_el.buffered.length-1)/this.video_el.duration*100;n.font="30px Helvetica Neue",n.fillStyle="yellow",n.textAlign="end",n.fillText(l.toFixed(0)+"% loaded",.95*this.bar_canvas.width,.6*this.bar_canvas.height)}n.fillStyle="yellow",n.font="35px Helvetica Neue",n.textAlign="center",n.fillText("Look+click on play or bar. Space bar and arrows also work.",this.bar_canvas.width/2,.8*this.bar_canvas.height),n.fillText("Double-click outside player to hide or show it",this.bar_canvas.width/2,.95*this.bar_canvas.height);for(var c=0;c<this.video_el.buffered.length;c++){var h=this.video_el.buffered.start(c)*o,d=this.video_el.buffered.end(c)*o,_=d-h;n.fillStyle="grey",n.fillRect(h,0,_,this.bar_canvas.height/3)}n.fillStyle="red",n.fillRect(0,0,this.video_el.currentTime/this.video_el.duration*this.bar_canvas.width,this.bar_canvas.height/3)}this.bar.object3D.children.length>0&&(null===this.bar.object3D.children[0].material.map&&(this.bar.object3D.children[0].material=new THREE.MeshBasicMaterial,this.bar.object3D.children[0].material.map=this.texture),this.texture.needsUpdate=!0)}this.last_time=e}},pause:function(){},play:function(){}})}]);